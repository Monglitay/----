# 2024年电赛智能巡线小车项目文档
## 项目概述
本项目是基于嘉立创地猛星（MSPM0G3507）最小系统板的智能巡线小车，采用五路红外传感器实现路径识别，通过PID算法进行闭环控制，具备蓝牙通信和状态机管理功能。

## 硬件架构
### 核心组件
- **主控单元**：嘉立创地猛星（MSPM0G3507）最小开发板
- **动力系统**：
  - 驱动电机：370直流电机 ×2
  - 驱动模块：TB6612双路H桥驱动
- **感知系统**：
  - 红外阵列：五路巡线模块
- **电源系统**：
  - 电池组：3.7V锂电池 ×4（串联输出14.8V）
  - 电压转换：
    - AMS1117-3.3（3.3V LDO）
    - LM2596（大电流DC-DC）
    - MP1584EN（高效降压模块）

## 引脚定义表
| 引脚名称            | GPIO引脚 | 功能描述                 |
|---------------------|----------|--------------------------|
| **I2C总线**         |          |                          |
| I2C_SDA             | A28      | MPU6050数据线           |
| I2C_SCL             | A31      | MPU6050时钟线           |
| **电机驱动**        |          |                          |
| TB6612_STBY         | A12      | 驱动芯片使能            |
| TB6612_AIN1         | B6       | 左电机方向控制1         |
| TB6612_AIN2         | B7       | 左电机方向控制2         |
| TB6612_BIN1         | A8       | 右电机方向控制1         |
| TB6612_BIN2         | A9       | 右电机方向控制2         |
| **编码器接口**      |          |                          |
| GPIO_Encoder_L_A    | B24      | 左编码器A相             |
| GPIO_Encoder_L_B    | B20      | 左编码器B相             |
| GPIO_Encoder_R_A    | A16      | 右编码器A相             |
| GPIO_Encoder_R_B    | A15      | 右编码器B相             |
| **巡线传感器**      |          |                          |
| Tracking_HW_1       | A23      | 最左侧红外传感器        |
| Tracking_HW_2       | A24      | 左侧红外传感器          |
| Tracking_HW_3       | A25      | 中央红外传感器          |
| Tracking_HW_4       | A26      | 右侧红外传感器          |
| Tracking_HW_5       | A27      | 最右侧红外传感器        |
| **蓝牙模块**        |          |                          |
| HC_06_TX            | A22      | 蓝牙模块数据接收        |
| HC_06_RX            | A21      | 蓝牙模块数据发送        |
| **PWM输出**         |          |                          |
| PWM_L               | A13      | 左电机速度控制          |
| PWM_R               | A14      | 右电机速度控制          |
| PWM_Buzzer          | A17      | 蜂鸣器控制              |

## 软件架构
### 系统特征
- **运行环境**：裸机系统（无操作系统）
- **开发环境**：Code Composer Studio (CCS)
- **核心算法**：
  - 双闭环PID控制（速度环+转向环）
  - 红外传感器状态机解析
  - 蓝牙指令解析状态机
- **功能模块**：
  - 电机差速控制
  - 编码器测速
  - 路径偏差计算
  - 人机交互（蜂鸣器提示）

## 文件结构
```
工程根目录/
├── app/                # 应用层模块
│   ├── buzzer/         # 蜂鸣器驱动
│   ├── encoder/        # 编码器接口
│   ├── hc_06/          # 蓝牙通信模块
│   ├── motor/          # 电机控制核心
│   ├── mpu6050/        # 姿态传感器（预留）
│   ├── tb6612/         # 驱动芯片底层
│   └── tracking/       # 巡线算法实现
├── lib/                # 通用库文件
│   ├── delay/          # 延时函数
│   ├── key/            # 按键检测
│   ├── pid/            # PID算法库
│   ├── task/           # 任务调度器
│   └── uart/           # 串口通信库
└── src/                # 主程序
    ├── main.c          # 系统初始化与主循环
    └── main.h          # 全局定义
```